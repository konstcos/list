var V=Object.defineProperty;var T=(i,e,t)=>e in i?V(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var y=(i,e,t)=>T(i,typeof e!="symbol"?e+"":e,t);import{x as L,_ as g,c as r,j as a,w as x,y as b,o,l as u,a as n,u as M,F as O,z as R,h as z,n as _,t as v}from"./index-EWT_rdbE.js";import{s as B}from"./index-ZotY_Llf.js";import{s as D}from"./index-DBcHjU2u.js";import"./index-BFZd6oa2.js";const w={async getUseLinks(){return(await L.post("links/user-links",{})).data},async saveLink(i){return(await L.post("links/save-link",{id:i.id,link:i.link})).data},async deleteLink(i){return(await L.post("links/delete-link",{link_id:i.id})).data}};class h{constructor(e={}){y(this,"id",0);y(this,"link","");this.id=e.id??0,this.link=e.link??""}clear(){this.link=""}}class C{async getUserLinks(){try{return await w.getUseLinks()}catch{return!1}}async saveLink(e){try{return await w.saveLink(e)}catch{return!1}}async deleteLink(e){try{return await w.deleteLink(e)}catch{return!1}}}class E{constructor(){this.linksRepository=new C}async getUserLinks(){try{const e=await this.linksRepository.getUserLinks();if(e.status==="success"){let t=[];for(let p of e.data.links)t.push(new h({id:p.id,link:p.link}));return t}return[]}catch{return!1}}async saveLink(e){try{return await this.linksRepository.saveLink(e)}catch{return!1}}async deleteLink(e){try{return await this.linksRepository.deleteLink(e)}catch{return!1}}}const N={name:"LinkEditor",setup(){const i=new C,e=new E;return{linkRepository:i,linkUseCase:e}},props:{modelValue:{type:Boolean,default:!1},link:{type:Object,required:!0}},data(){return{modalOpen:this.value,linkEditor:{id:0,link:""},loading:!1}},watch:{modelValue(i){i?this.openModal():this.closeModal()},modalOpen(i){i&&(this.linkEditor.id=this.link.id,this.linkEditor.link=this.link.link)}},methods:{openModal(){this.modalOpen=!0,this.clearLinkData()},closeModal(){this.modalOpen=!1,this.$emit("update:modelValue",!1)},async saveLink(){this.loading=!0,await this.linkRepository.saveLink(new h({id:this.linkEditor.id,link:this.linkEditor.link})),this.loading=!1,this.$emit("reload"),this.closeModal()},clearLinkData(){this.linkEditor={id:0,link:""}}}},j={key:0},q={key:0,class:"w-full px-2"},I={class:"flex justify-end gap-2 mt-4"};function F(i,e,t,p,s,d){const m=D,k=M,f=b;return o(),r("div",null,[a(f,{visible:s.modalOpen,"onUpdate:visible":e[1]||(e[1]=c=>s.modalOpen=c),modal:"",header:"Линк",style:{width:"25rem"},onHide:d.closeModal},{default:x(()=>[s.modalOpen?(o(),r("div",j,[s.linkEditor?(o(),r("div",q,[a(m,{modelValue:s.linkEditor.link,"onUpdate:modelValue":e[0]||(e[0]=c=>s.linkEditor.link=c),rows:"3",required:"",placeholder:"Link",fluid:""},null,8,["modelValue"])])):u("",!0)])):u("",!0),n("div",I,[a(k,{type:"button",label:"Закрыть",size:"small",severity:"secondary",onClick:d.closeModal},null,8,["onClick"]),a(k,{type:"button",label:"Сохранить",size:"small",severity:"success",onClick:d.saveLink},null,8,["onClick"])])]),_:1},8,["visible","onHide"])])}const H=g(N,[["render",F],["__scopeId","data-v-7a4ffad8"]]),A={name:"Links",components:{LinkEditor:H},setup(){return{linksUseCase:new E}},data(){return{links:[],loading:!1,errorType:null,newLink:null,linkEditorModal:{show:!1,link:{}},deleteLinkModal:{show:!1,link:null}}},methods:{clearNewLink(){this.newLink=null,this.errorType=null},async saveLink(){if(this.newLink&&this.newLink.trim().length===0)return!1;this.errorType=null,this.loading=!0;const i=await this.linksUseCase.saveLink(new h({id:0,link:this.newLink}));if(this.loading=!1,i.status==="fail")return i.info==="wrong_url_format"?this.errorType="wrong_url_format":i.info==="link_already_exists"?this.errorType="link_already_exists":this.errorType="unknown_error",!1;this.newLink=null,this.loadLinks()},openLinkEditor(i=null){this.linkEditorModal.link=i||new h,this.linkEditorModal.show=!0},async loadLinks(){this.loading=!0,this.links=await this.linksUseCase.getUserLinks(),this.loading=!1},openDeleteLinkModal(i){this.deleteLinkModal.link=i,this.deleteLinkModal.show=!0},async deleteLink(){if(this.deleteLinkModal&&!this.deleteLinkModal.link)return!1;await this.linksUseCase.deleteLink(this.deleteLinkModal.link),this.deleteLinkModal.show=!1,this.loadLinks()}},mounted(){this.loadLinks()}},S={class:"mt-4"},W={class:"mb-4"},G={class:"flex flex-wrap -mx-2"},J={class:"w-full md:w-1/2 px-2"},K={class:"w-full md:w-1/2 px-2"},P={key:0,class:"wrong-url-format mt-2 ml-1 mb-4"},Q={key:1,class:"wrong-url-format mt-2 ml-1 mb-4"},X={key:2,class:"wrong-url-format mt-2 ml-1 mb-4"},Y={key:0,class:"mb-4"},Z={class:"flex flex-wrap mb-2"},$={class:"link-id"},ee=["href"],ie={key:1,class:"mb-4"},se={class:"flex justify-end gap-2"};function le(i,e,t,p,s,d){const m=B,k=M,f=z("LinkEditor"),c=b;return o(),r("div",null,[e[8]||(e[8]=n("h1",null,"Каталог ссылок",-1)),n("div",S,[n("div",W,[n("div",G,[n("div",J,[a(m,{modelValue:s.newLink,"onUpdate:modelValue":e[0]||(e[0]=l=>s.newLink=l),type:"text",required:"",placeholder:"link",fluid:""},null,8,["modelValue"])]),n("div",K,[a(k,{label:"Сохранить",size:"small",loading:s.loading,onClick:e[1]||(e[1]=l=>d.saveLink())},null,8,["loading"]),a(k,{label:"Очистить",class:"ml-2",size:"small",severity:"secondary",onClick:e[2]||(e[2]=l=>d.clearNewLink())})])]),s.errorType==="wrong_url_format"?(o(),r("div",P," не правильный формат линка ")):u("",!0),s.errorType==="unknown_error"?(o(),r("div",Q," не известная ошибка при сохранении, попробуйте позже ")):u("",!0),s.errorType==="link_already_exists"?(o(),r("div",X," Точно такой же линк уже существует в системе ")):u("",!0)]),s.loading?(o(),r("div",Y," Загрузка... ")):u("",!0),n("div",null,[(o(!0),r(O,null,R(s.links,l=>(o(),r("div",{key:l.id},[n("div",Z,[n("div",null,[n("div",$,v(l.id),1),n("a",{class:"",href:l.link,target:"_blank"},v(l.link),9,ee),s.loading?u("",!0):(o(),_(k,{key:0,class:"!px-2 !py-1 !text-xs !h-7 ml-3",onClick:U=>d.openLinkEditor(l),disabled:s.loading,icon:"pi pi-pencil",severity:"info",variant:"text",rounded:""},null,8,["onClick","disabled"])),s.loading?u("",!0):(o(),_(k,{key:1,class:"!px-2 !py-1 !text-xs !h-7",onClick:U=>d.openDeleteLinkModal(l),disabled:s.loading,icon:"pi pi-times",severity:"danger",variant:"text",rounded:""},null,8,["onClick","disabled"]))])])]))),128))]),!s.loading&&s.links.length===0?(o(),r("div",ie," Ссылок пока нет ")):u("",!0)]),a(f,{modelValue:s.linkEditorModal.show,"onUpdate:modelValue":e[3]||(e[3]=l=>s.linkEditorModal.show=l),link:s.linkEditorModal.link,onReload:e[4]||(e[4]=l=>d.loadLinks())},null,8,["modelValue","link"]),a(c,{visible:s.deleteLinkModal.show,"onUpdate:visible":e[6]||(e[6]=l=>s.deleteLinkModal.show=l),modal:"",header:"Удаление линка",style:{width:"25rem"}},{default:x(()=>[e[7]||(e[7]=n("span",{class:"text-surface-500 dark:text-surface-400 block mb-8"},"Уверены что хотите удалить линк?",-1)),n("div",se,[a(k,{type:"button",label:"Отмена",size:"small",severity:"secondary",onClick:e[5]||(e[5]=l=>s.deleteLinkModal.show=!1)}),a(k,{type:"button",label:"Удалить",size:"small",severity:"danger",onClick:d.deleteLink},null,8,["onClick"])])]),_:1},8,["visible"])])}const de=g(A,[["render",le],["__scopeId","data-v-138ea2f1"]]);export{de as default};
