import{s as x}from"./index-B86KKlKY.js";import{a as E}from"./index-CDgpnmKN.js";import{a as b,s as w}from"./index-DQU1RdDO.js";import{_ as m,c,j as i,w as p,y as k,o as r,l as g,a,n as M,u as h,q as V,F as T,z as U,h as j,t as B}from"./index-DmyVSq3C.js";import{a as O,T as z}from"./TaxonomyCategoryUseCase-axfPNekK.js";const q={name:"TaxonomyCategoryEditor",setup(){return{categoryRepository:new O}},props:{modelValue:{type:Boolean,default:!1},category:{type:Object,required:!0}},data(){return{modalOpen:this.value,categoryEditor:{id:0,slug:"",title:"",description:""},loading:!1}},watch:{modelValue(o){o?this.openModal():this.closeModal()},modalOpen(o){o&&(this.categoryEditor.id=this.category.id,this.categoryEditor.slug=this.category.slug,this.categoryEditor.title=this.category.title,this.categoryEditor.description=this.category.description)}},methods:{openModal(){this.modalOpen=!0,this.clearCategoryData()},closeModal(){this.modalOpen=!1,this.$emit("update:modelValue",!1)},async saveCategory(){this.loading=!0,await this.categoryRepository.saveCategory({id:this.categoryEditor.id,slug:this.categoryEditor.slug,title:this.categoryEditor.title,description:this.categoryEditor.description}),this.loading=!1,this.$emit("reload"),this.closeModal()},clearCategoryData(){this.categoryEditor={id:0,slug:"",title:"",description:""}}}},D={key:0},R={key:0,class:"w-full px-2"},A={class:"flex justify-end gap-2 mt-4"};function I(o,e,C,f,t,s){const n=b,y=h,u=k;return r(),c("div",null,[i(u,{visible:t.modalOpen,"onUpdate:visible":e[3]||(e[3]=l=>t.modalOpen=l),modal:"",header:"Редактор категории",style:{width:"25rem"},onHide:s.closeModal},{default:p(()=>[t.modalOpen?(r(),c("div",D,[t.categoryEditor?(r(),c("div",R,[t.categoryEditor.id===0?(r(),M(n,{key:0,modelValue:t.categoryEditor.slug,"onUpdate:modelValue":e[0]||(e[0]=l=>t.categoryEditor.slug=l),rows:"1",required:"",placeholder:"slug",fluid:""},null,8,["modelValue"])):g("",!0),i(n,{modelValue:t.categoryEditor.title,"onUpdate:modelValue":e[1]||(e[1]=l=>t.categoryEditor.title=l),rows:"1",required:"",placeholder:"title",fluid:""},null,8,["modelValue"]),i(n,{modelValue:t.categoryEditor.description,"onUpdate:modelValue":e[2]||(e[2]=l=>t.categoryEditor.description=l),rows:"4",required:"",placeholder:"description",fluid:""},null,8,["modelValue"])])):g("",!0)])):g("",!0),a("div",A,[i(y,{type:"button",label:"Закрыть",size:"small",severity:"secondary",onClick:s.closeModal},null,8,["onClick"]),i(y,{type:"button",label:"Сохранить",size:"small",severity:"success",onClick:s.saveCategory},null,8,["onClick"])])]),_:1},8,["visible","onHide"])])}const N=m(q,[["render",I],["__scopeId","data-v-1063b6ee"]]),L={name:"TaxonomyCategoriesView",setup(){return{taxonomyCategoryUseCase:new z}},data(){return{categories:[],loading:!1,categoryEditorModal:{show:!1,category:{}},activeCategory:null,deleteCategoryModal:{show:!1,categoryId:0,loading:!1}}},components:{TaxonomyCategoryEditor:N},methods:{openMenu(o,e){this.activeCategory=e,this.$refs.menu_popover.toggle(o)},editActiveCategory(){this.activeCategory&&(this.openCategoryEditor(this.activeCategory),this.$refs.menu_popover.hide())},deleteActiveCategory(){this.activeCategory&&(this.deleteCategory(this.activeCategory),this.$refs.menu_popover.hide())},async loadCategories(){this.loading=!0;const o=await this.taxonomyCategoryUseCase.getUserCategories();o===!1?alert("Ошибка при загрузке данных"):this.categories=o,this.loading=!1},openCategoryEditor(o=null){this.categoryEditorModal.category={id:0,slug:"",title:"",description:""},o&&(this.categoryEditorModal.category=o),this.categoryEditorModal.show=!0},deleteCategory(o){this.deleteCategoryModal.categoryId=o.id,this.$confirm.require({message:"Подтвердите удаление категории",header:"Подтверждение удаления",icon:"pi pi-exclamation-triangle",acceptLabel:"Да",rejectLabel:"Отмена",accept:()=>{this.makeDeleteCategory()},reject:()=>{},acceptClass:"p-button-text p-button-danger p-button-sm",rejectClass:"p-button-text p-button-secondary p-button-sm"})},async makeDeleteCategory(){this.deleteCategoryModal.loading=!0,await this.taxonomyCategoryUseCase.deleteCategory(this.deleteCategoryModal.categoryId)===!1?alert("Ошибка при удалении категории"):this.loadCategories(),this.deleteCategoryModal.loading=!1,this.deleteCategoryModal.show=!1}},mounted(){this.loadCategories()}},F={key:0,class:"mt-3"},H={class:"mt-4"},P={class:"w-full md:w-1/2 px-2"},S={class:""},G={class:"flex justify-content-between align-items-center pb-3 surface-card shadow-1 border-round mb-2"},J={class:"flex-1"},K=["onClick"],Q={key:1,class:"mb-4"},W={style:{display:"flex","flex-direction":"column",gap:"8px",width:"150px"}};function X(o,e,C,f,t,s){const n=h,y=w,u=E,l=x,v=j("TaxonomyCategoryEditor");return r(),c("div",null,[a("h1",null,[e[4]||(e[4]=V(" Категории ")),i(n,{variant:"text",icon:"pi pi-plus",rounded:"",severity:"info",loading:t.loading,size:"small",onClick:e[0]||(e[0]=d=>s.openCategoryEditor())},null,8,["loading"]),i(n,{variant:"text",icon:"pi pi-refresh",rounded:"",severity:"info",loading:t.loading,size:"small",onClick:e[1]||(e[1]=d=>s.loadCategories())},null,8,["loading"])]),t.loading?(r(),c("div",F,[i(y,{color:"info",mode:"indeterminate",style:{height:"4px"},pt:{value:{style:{backgroundColor:"#38bdf9"}}}})])):g("",!0),a("div",H,[(r(!0),c(T,null,U(t.categories,d=>(r(),c("div",{key:d.id,class:"flex flex-wrap mb-2"},[a("div",P,[a("div",S,[i(u,null,{content:p(()=>[a("div",G,[a("div",J,B(d.title),1),a("i",{class:"cursor-pointer pi pi-ellipsis-v ml-2 mt-2",onClick:_=>s.openMenu(_,d)},null,8,K)])]),_:2},1024)])])]))),128))]),!t.loading&&t.categories.length===0?(r(),c("div",Q," Категорий пока нет ")):g("",!0),i(l,{ref:"menu_popover"},{default:p(()=>[a("div",W,[i(n,{label:"Редактировать",icon:"pi pi-pencil",onClick:s.editActiveCategory,style:{width:"100%","justify-content":"flex-start"},class:"p-button-text",size:"small"},null,8,["onClick"]),i(n,{label:"Удалить",icon:"pi pi-trash",onClick:s.deleteActiveCategory,style:{width:"100%","justify-content":"flex-start"},class:"p-button-text p-button-danger",size:"small"},null,8,["onClick"])])]),_:1},512),i(v,{modelValue:t.categoryEditorModal.show,"onUpdate:modelValue":e[2]||(e[2]=d=>t.categoryEditorModal.show=d),category:t.categoryEditorModal.category,onReload:e[3]||(e[3]=d=>s.loadCategories())},null,8,["modelValue","category"])])}const oe=m(L,[["render",X]]);export{oe as default};
