import{s as b,a as k}from"./index-Cg728ovt.js";import{a as M}from"./index-DEcRA8vA.js";import{x as C,_ as v,c as y,j as s,w as f,y as V,o as l,l as g,a as i,n as U,u as x,q as T,F as j,z as R,h as B,t as O}from"./index-BobiO0F-.js";import{s as z}from"./index-Dra7jdLS.js";const h={async getUseCategories(){return(await C.post("taxonomy/categories/user-categories",{})).data},async saveCategory(t){return(await C.post("taxonomy/categories/save-category",{id:t.id,slug:t.slug,title:t.title,description:t.description})).data},async deleteCategory(t){return(await C.post("taxonomy/categories/delete-category",{category_id:t})).data}};class _{async getUserCategories(){try{return await h.getUseCategories()}catch{return!1}}async saveCategory(e){try{return await h.saveCategory(e)}catch{return!1}}async deleteCategory(e){try{return await h.deleteCategory(e)}catch{return!1}}}class q{constructor(){this.taxonomyCategoryRepository=new _}async getUserCategories(){try{const e=await this.taxonomyCategoryRepository.getUserCategories();if(e.status==="success"){let n=[];for(let p of e.data.categories)n.push(p);return n}return[]}catch{return!1}}async saveCategory(e){try{return await this.taxonomyCategoryRepository.saveCategory(e)}catch{return!1}}async deleteCategory(e){try{return await this.taxonomyCategoryRepository.deleteCategory(e)}catch{return!1}}}const D={name:"TaxonomyCategoryEditor",setup(){return{categoryRepository:new _}},props:{modelValue:{type:Boolean,default:!1},category:{type:Object,required:!0}},data(){return{modalOpen:this.value,categoryEditor:{id:0,slug:"",title:"",description:""},loading:!1}},watch:{modelValue(t){t?this.openModal():this.closeModal()},modalOpen(t){t&&(this.categoryEditor.id=this.category.id,this.categoryEditor.slug=this.category.slug,this.categoryEditor.title=this.category.title,this.categoryEditor.description=this.category.description)}},methods:{openModal(){this.modalOpen=!0,this.clearCategoryData()},closeModal(){this.modalOpen=!1,this.$emit("update:modelValue",!1)},async saveCategory(){this.loading=!0,await this.categoryRepository.saveCategory({id:this.categoryEditor.id,slug:this.categoryEditor.slug,title:this.categoryEditor.title,description:this.categoryEditor.description}),this.loading=!1,this.$emit("reload"),this.closeModal()},clearCategoryData(){this.categoryEditor={id:0,slug:"",title:"",description:""}}}},A={key:0},I={key:0,class:"w-full px-2"},N={class:"flex justify-end gap-2 mt-4"};function L(t,e,n,p,o,r){const d=z,u=x,m=V;return l(),y("div",null,[s(m,{visible:o.modalOpen,"onUpdate:visible":e[3]||(e[3]=a=>o.modalOpen=a),modal:"",header:"Редактор категории",style:{width:"25rem"},onHide:r.closeModal},{default:f(()=>[o.modalOpen?(l(),y("div",A,[o.categoryEditor?(l(),y("div",I,[o.categoryEditor.id===0?(l(),U(d,{key:0,modelValue:o.categoryEditor.slug,"onUpdate:modelValue":e[0]||(e[0]=a=>o.categoryEditor.slug=a),rows:"1",required:"",placeholder:"slug",fluid:""},null,8,["modelValue"])):g("",!0),s(d,{modelValue:o.categoryEditor.title,"onUpdate:modelValue":e[1]||(e[1]=a=>o.categoryEditor.title=a),rows:"1",required:"",placeholder:"title",fluid:""},null,8,["modelValue"]),s(d,{modelValue:o.categoryEditor.description,"onUpdate:modelValue":e[2]||(e[2]=a=>o.categoryEditor.description=a),rows:"4",required:"",placeholder:"description",fluid:""},null,8,["modelValue"])])):g("",!0)])):g("",!0),i("div",N,[s(u,{type:"button",label:"Закрыть",size:"small",severity:"secondary",onClick:r.closeModal},null,8,["onClick"]),s(u,{type:"button",label:"Сохранить",size:"small",severity:"success",onClick:r.saveCategory},null,8,["onClick"])])]),_:1},8,["visible","onHide"])])}const F=v(D,[["render",L],["__scopeId","data-v-1063b6ee"]]),H={name:"TaxonomyCategoriesView",setup(){return{taxonomyCategoryUseCase:new q}},data(){return{categories:[],loading:!1,categoryEditorModal:{show:!1,category:{}},activeCategory:null,deleteCategoryModal:{show:!1,categoryId:0,loading:!1}}},components:{TaxonomyCategoryEditor:F},methods:{openMenu(t,e){this.activeCategory=e,this.$refs.menu_popover.toggle(t)},editActiveCategory(){this.activeCategory&&(this.openCategoryEditor(this.activeCategory),this.$refs.menu_popover.hide())},deleteActiveCategory(){this.activeCategory&&(this.deleteCategory(this.activeCategory),this.$refs.menu_popover.hide())},async loadCategories(){this.loading=!0;const t=await this.taxonomyCategoryUseCase.getUserCategories();t===!1?alert("Ошибка при загрузке данных"):this.categories=t,this.loading=!1},openCategoryEditor(t=null){this.categoryEditorModal.category={id:0,slug:"",title:"",description:""},t&&(this.categoryEditorModal.category=t),this.categoryEditorModal.show=!0},deleteCategory(t){this.deleteCategoryModal.categoryId=t.id,this.$confirm.require({message:"Подтвердите удаление категории",header:"Подтверждение удаления",icon:"pi pi-exclamation-triangle",acceptLabel:"Да",rejectLabel:"Отмена",accept:()=>{this.makeDeleteCategory()},reject:()=>{},acceptClass:"p-button-text p-button-danger p-button-sm",rejectClass:"p-button-text p-button-secondary p-button-sm"})},async makeDeleteCategory(){this.deleteCategoryModal.loading=!0,await this.taxonomyCategoryUseCase.deleteCategory(this.deleteCategoryModal.categoryId)===!1?alert("Ошибка при удалении категории"):this.loadCategories(),this.deleteCategoryModal.loading=!1,this.deleteCategoryModal.show=!1}},mounted(){this.loadCategories()}},P={key:0,class:"mt-3"},S={class:"mt-4"},G={class:"w-full md:w-1/2 px-2"},J={class:""},K={class:"flex justify-content-between align-items-center pb-3 surface-card shadow-1 border-round mb-2"},Q={class:"flex-1"},W=["onClick"],X={key:1,class:"mb-4"},Y={style:{display:"flex","flex-direction":"column",gap:"8px",width:"150px"}};function Z(t,e,n,p,o,r){const d=x,u=b,m=M,a=k,w=B("TaxonomyCategoryEditor");return l(),y("div",null,[i("h1",null,[e[4]||(e[4]=T(" Категории ")),s(d,{variant:"text",icon:"pi pi-plus",rounded:"",severity:"info",loading:o.loading,size:"small",onClick:e[0]||(e[0]=c=>r.openCategoryEditor())},null,8,["loading"]),s(d,{variant:"text",icon:"pi pi-refresh",rounded:"",severity:"info",loading:o.loading,size:"small",onClick:e[1]||(e[1]=c=>r.loadCategories())},null,8,["loading"])]),o.loading?(l(),y("div",P,[s(u,{color:"info",mode:"indeterminate",style:{height:"4px"},pt:{value:{style:{backgroundColor:"#38bdf9"}}}})])):g("",!0),i("div",S,[(l(!0),y(j,null,R(o.categories,c=>(l(),y("div",{key:c.id,class:"flex flex-wrap mb-2"},[i("div",G,[i("div",J,[s(m,null,{content:f(()=>[i("div",K,[i("div",Q,O(c.title),1),i("i",{class:"cursor-pointer pi pi-ellipsis-v ml-2 mt-2",onClick:E=>r.openMenu(E,c)},null,8,W)])]),_:2},1024)])])]))),128))]),!o.loading&&o.categories.length===0?(l(),y("div",X," Категорий пока нет ")):g("",!0),s(a,{ref:"menu_popover"},{default:f(()=>[i("div",Y,[s(d,{label:"Редактировать",icon:"pi pi-pencil",onClick:r.editActiveCategory,style:{width:"100%","justify-content":"flex-start"},class:"p-button-text",size:"small"},null,8,["onClick"]),s(d,{label:"Удалить",icon:"pi pi-trash",onClick:r.deleteActiveCategory,style:{width:"100%","justify-content":"flex-start"},class:"p-button-text p-button-danger",size:"small"},null,8,["onClick"])])]),_:1},512),s(w,{modelValue:o.categoryEditorModal.show,"onUpdate:modelValue":e[2]||(e[2]=c=>o.categoryEditorModal.show=c),category:o.categoryEditorModal.category,onReload:e[3]||(e[3]=c=>r.loadCategories())},null,8,["modelValue","category"])])}const se=v(H,[["render",Z]]);export{se as default};
