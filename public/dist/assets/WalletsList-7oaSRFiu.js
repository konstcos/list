var T=Object.defineProperty;var z=(l,e,t)=>e in l?T(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var f=(l,e,t)=>(z(l,typeof e!="symbol"?e+"":e,t),t);import{f as C,_ as N,r as n,o as d,c as u,d as a,w as s,e as h,g as U,b as m,p as F,h as A,a as B,F as R,i as P,m as j,t as O}from"./index-niEc4CDs.js";class E{constructor(e={}){f(this,"id",0);f(this,"name","");f(this,"description","");f(this,"сurrency","");f(this,"balance",0);this.id=e.id??0,this.name=e.name??"",this.description=e.description??"",this.balance=e.balance??0}clear(){this.name="",this.description="",this.balance=0}}const k={async getUserWallets(){return(await C.post("wallet/user-wallets",{})).data},async getWalletDetail(l){return(await C.post("wallet/detail",{wallet_id:l})).data},async saveWallet(l){return(await C.post("wallet/save",l)).data},async deleteWallet(l){return(await C.post("wallet/delete",{wallet_id:l})).data}};class I{async getUserWallets(){try{const e=await k.getUserWallets();if(e.status==="success")return e}catch{return!1}}async saveWallet(e){try{const t=await k.saveWallet({id:e.id,name:e.name,description:e.description,balance:e.balance});if(t.status==="success")return t}catch{return!1}}async getWalletDetail(e){try{const t=await k.getWalletDetail(e);if(t.status==="success")return t}catch{return!1}}async deleteWallet(e){try{const t=await k.deleteWallet(e);return t.status==="success"?t:!1}catch{return!1}}}class S{constructor(){this.walletRepository=new I}async getUserWallets(){try{const e=await this.walletRepository.getUserWallets();if(e.status==="success"){let t=[];for(let w of e.data.wallets)t.push(new E({id:w.id,name:w.name,description:w.description,balance:w.balance}));return t}}catch{return!1}}async getWalletDetail(e){try{const t=await this.walletRepository.getWalletDetail(e);return t.status==="success"?new E({id:t.data.wallet.id,name:t.data.wallet.name,description:t.data.wallet.description,balance:t.data.wallet.balance}):!1}catch{return!1}}async deleteWallet(e){try{return(await this.walletRepository.deleteWallet(e)).status==="success"}catch{return!1}}}const q={name:"WalletEditor",setup(){const l=new I,e=new S;return{walletRepository:l,walletUseCase:e}},props:{modelValue:{type:Boolean,default:!1},walletId:{type:Number,default:0}},data(){return{modalOpen:this.value,wallet:null,loading:!0}},watch:{modelValue(l){l?this.openModal():this.closeModal()},modalOpen(l){l&&this.loadWalletData()}},methods:{openModal(){this.modalOpen=!0,this.clearWalletData()},closeModal(){this.modalOpen=!1,this.$emit("update:modelValue",!1)},async saveWallet(){this.loading=!0,await this.walletRepository.saveWallet(this.wallet),this.loading=!1,this.$emit("reload"),this.closeModal()},clearWalletData(){this.wallet&&this.wallet.clear()},async getWalletData(){this.wallet=null,this.loading=!0;const l=await this.walletUseCase.getWalletDetail(this.walletId);l===!1?alert("Ошибка при загрузке данных кошелька"):this.wallet=l,this.loading=!1},loadWalletData(){this.walletId===0?(this.wallet=new E,this.loading=!1):this.getWalletData()}}},G=l=>(F("data-v-a52dbbcf"),l=l(),A(),l),H=G(()=>B("span",{class:"headline"},"Создание нового кошелька",-1)),J={key:0},K={key:1};function Q(l,e,t,w,o,i){const c=n("v-card-title"),y=n("v-progress-linear"),b=n("v-text-field"),V=n("v-textarea"),W=n("v-card-text"),g=n("v-btn"),v=n("v-spacer"),M=n("v-card-actions"),x=n("v-card"),D=n("v-dialog");return d(),u("div",null,[a(D,{modelValue:o.modalOpen,"onUpdate:modelValue":e[2]||(e[2]=_=>o.modalOpen=_),"max-width":"500px","onClick:outside":i.closeModal},{default:s(()=>[a(x,null,{default:s(()=>[a(c,null,{default:s(()=>[H]),_:1}),o.modalOpen?(d(),U(W,{key:0},{default:s(()=>[o.loading?(d(),u("div",J,[a(y,{indeterminate:"",color:"primary"})])):h("",!0),o.wallet?(d(),u("div",K,[a(b,{modelValue:o.wallet.name,"onUpdate:modelValue":e[0]||(e[0]=_=>o.wallet.name=_),label:"Name"},null,8,["modelValue"]),a(V,{modelValue:o.wallet.description,"onUpdate:modelValue":e[1]||(e[1]=_=>o.wallet.description=_),label:"Description"},null,8,["modelValue"])])):h("",!0)]),_:1})):h("",!0),a(M,null,{default:s(()=>[a(g,{density:"compact",color:"primary",onClick:i.closeModal},{default:s(()=>[m("Закрыть")]),_:1},8,["onClick"]),a(v),a(g,{density:"compact",color:"primary",onClick:i.saveWallet},{default:s(()=>[m("Сохранить")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","onClick:outside"])])}const X=N(q,[["render",Q],["__scopeId","data-v-a52dbbcf"]]),Y={name:"WalletsList",setup(){const l=new I,e=new S(l);return{walletRepository:l,walletUseCase:e}},components:{WalletEditor:X},data(){return{wallets:[],loading:!1,walletEditorModal:{show:!1,walletId:0},deleteWalletModal:{show:!1,walletId:0,loading:!1}}},methods:{async loadWallets(){this.loading=!0;const l=await this.walletUseCase.getUserWallets();l===!1?alert("Ошибка при загрузке кошельков"):this.wallets=l,this.loading=!1},openWalletEditor(l=0){this.walletEditorModal.walletId=l,this.walletEditorModal.show=!0},showWalletDetail(l){console.log("showWalletDetail",l)},deleteWallet(l){this.deleteWalletModal.walletId=l,this.deleteWalletModal.show=!0},cancelDelation(){this.deleteWalletModal.show=!1,this.deleteWalletModal.walletId=0},async makeDeleteWallet(){this.deleteWalletModal.loading=!0,await this.walletUseCase.deleteWallet(this.deleteWalletModal.walletId)===!1?alert("Ошибка при удалении кошелька"):this.loadWallets(),this.deleteWalletModal.loading=!1,this.deleteWalletModal.show=!1}},mounted(){this.loadWallets()}},Z={key:0},$={key:1,class:"text-center"},ee={key:2,class:"mt-3"};function le(l,e,t,w,o,i){const c=n("v-btn"),y=n("VCol"),b=n("VRow"),V=n("v-progress-linear"),W=n("v-list-item-title"),g=n("v-list-item-subtitle"),v=n("v-list-item"),M=n("v-list"),x=n("v-menu"),D=n("VCardText"),_=n("VCard"),L=n("WalletEditor");return d(),u("div",null,[B("div",null,[a(_,null,{default:s(()=>[a(D,null,{default:s(()=>[a(b,{class:"mb-3"},{default:s(()=>[a(y,null,{default:s(()=>[a(c,{loading:o.loading,onClick:i.loadWallets,color:"primary",density:"compact",icon:"mdi:mdi-reload"},null,8,["loading","onClick"])]),_:1}),a(y,{class:"text-end"},{default:s(()=>[a(c,{onClick:e[0]||(e[0]=r=>i.openWalletEditor(0)),disabled:o.loading,density:"compact",icon:"mdi:mdi-plus"},null,8,["disabled"])]),_:1})]),_:1}),o.loading?(d(),u("div",Z,[a(V,{indeterminate:"",color:"primary"})])):h("",!0),!o.loading&&o.wallets.length===0?(d(),u("div",$," у вас пока нет кошельков ")):h("",!0),o.wallets.length>0?(d(),u("div",ee,[(d(!0),u(R,null,P(o.wallets,r=>(d(),U(v,{key:r.id,variant:"elevated",class:"mb-3"},{append:s(()=>[o.deleteWalletModal.show&&o.deleteWalletModal.walletId===r.id?(d(),u(R,{key:0},[a(c,{size:"x-small",onClick:e[1]||(e[1]=p=>i.cancelDelation()),disabled:o.deleteWalletModal.loading},{default:s(()=>[m("отмена")]),_:1},8,["disabled"]),a(c,{size:"x-small",onClick:e[2]||(e[2]=p=>i.makeDeleteWallet()),class:"ml-1",color:"red-accent-4",loading:o.deleteWalletModal.loading},{default:s(()=>[m("удалить")]),_:1},8,["loading"])],64)):(d(),U(x,{key:1},{activator:s(({props:p})=>[a(c,j({icon:"mdi:mdi-dots-vertical"},p,{color:"grey-lighten-1",variant:"text"}),null,16)]),default:s(()=>[a(M,{class:"text-center"},{default:s(()=>[a(v,null,{default:s(()=>[a(W,null,{default:s(()=>[a(c,{density:"compact",onClick:p=>i.openWalletEditor(r.id)},{default:s(()=>[m(" Редактировать ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),a(v,null,{default:s(()=>[a(W,null,{default:s(()=>[a(c,{density:"compact",onClick:p=>i.deleteWallet(r.id),color:"red-accent-4"},{default:s(()=>[m(" Удалить ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))]),default:s(()=>[a(W,{onClick:p=>i.showWalletDetail(r.id)},{default:s(()=>[m(O(r.balance)+" грн ",1)]),_:2},1032,["onClick"]),a(g,{onClick:p=>i.showWalletDetail(r.id)},{default:s(()=>[m(O(r.name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))])):h("",!0)]),_:1})]),_:1})]),a(L,{modelValue:o.walletEditorModal.show,"onUpdate:modelValue":e[3]||(e[3]=r=>o.walletEditorModal.show=r),"wallet-id":o.walletEditorModal.walletId,onReload:e[4]||(e[4]=r=>i.loadWallets())},null,8,["modelValue","wallet-id"])])}const se=N(Y,[["render",le]]);export{se as W};
