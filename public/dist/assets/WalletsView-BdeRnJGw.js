var V=Object.defineProperty;var I=(t,e,l)=>e in t?V(t,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[e]=l;var h=(t,e,l)=>I(t,typeof e!="symbol"?e+"":e,l);import{a as R}from"./index-BUfSqVg0.js";import{s as B}from"./index-5CiErfQm.js";import{l as W,_ as b,c as n,d as a,w as g,n as j,o as r,g as m,a as i,p as C,k as M,r as D,F as L,q as O,t as k}from"./index-C5Uagddi.js";import{s as z}from"./index-BMYLANRs.js";class v{constructor(e={}){h(this,"id",0);h(this,"name","");h(this,"description","");h(this,"сurrency","");h(this,"balance",0);this.id=e.id??0,this.name=e.name??"",this.description=e.description??"",this.balance=e.balance??0}clear(){this.name="",this.description="",this.balance=0}}const _={async getUserWallets(){return(await W.post("wallet/user-wallets",{})).data},async getWalletDetail(t){return(await W.post("wallet/detail",{wallet_id:t})).data},async saveWallet(t){return(await W.post("wallet/save",t)).data},async deleteWallet(t){return(await W.post("wallet/delete",{wallet_id:t})).data}};class x{async getUserWallets(){try{const e=await _.getUserWallets();if(e.status==="success")return e}catch{return!1}}async saveWallet(e){try{const l=await _.saveWallet({id:e.id,name:e.name,description:e.description,balance:e.balance});if(l.status==="success")return l}catch{return!1}}async getWalletDetail(e){try{const l=await _.getWalletDetail(e);if(l.status==="success")return l}catch{return!1}}async deleteWallet(e){try{const l=await _.deleteWallet(e);return l.status==="success"?l:!1}catch{return!1}}}class E{constructor(){this.walletRepository=new x}async getUserWallets(){try{const e=await this.walletRepository.getUserWallets();if(e.status==="success"){let l=[];for(let u of e.data.wallets)l.push(new v({id:u.id,name:u.name,description:u.description,balance:u.balance}));return l}}catch{return!1}}async getWalletDetail(e){try{const l=await this.walletRepository.getWalletDetail(e);return l.status==="success"?new v({id:l.data.wallet.id,name:l.data.wallet.name,description:l.data.wallet.description,balance:l.data.wallet.balance}):!1}catch{return!1}}async deleteWallet(e){try{return(await this.walletRepository.deleteWallet(e)).status==="success"}catch{return!1}}}const A={name:"WalletEditor",setup(){const t=new x,e=new E;return{walletRepository:t,walletUseCase:e}},props:{modelValue:{type:Boolean,default:!1},walletId:{type:Number,default:0}},data(){return{modalOpen:this.value,wallet:null,loading:!0}},watch:{modelValue(t){t?this.openModal():this.closeModal()},modalOpen(t){t&&this.loadWalletData()}},methods:{openModal(){this.modalOpen=!0,this.clearWalletData()},closeModal(){this.modalOpen=!1,this.$emit("update:modelValue",!1)},async saveWallet(){this.loading=!0,await this.walletRepository.saveWallet(this.wallet),this.loading=!1,this.$emit("reload"),this.closeModal()},clearWalletData(){this.wallet&&this.wallet.clear()},async getWalletData(){this.wallet=null,this.loading=!0;const t=await this.walletUseCase.getWalletDetail(this.walletId);t===!1?alert("Ошибка при загрузке данных кошелька"):this.wallet=t,this.loading=!1},loadWalletData(){this.walletId===0?(this.wallet=new v,this.loading=!1):this.getWalletData()}}},N={key:0},q={key:1},P={key:0,class:"w-full px-2"},$={class:"flex justify-end gap-2 mt-4"};function F(t,e,l,u,s,o){const d=C,w=z,f=M,y=j;return r(),n("div",null,[a(y,{visible:s.modalOpen,"onUpdate:visible":e[2]||(e[2]=p=>s.modalOpen=p),"max-width":"500px",modal:"",header:l.walletId>0?"Редактирование кошелька":"Создание нового кошелька",onHide:o.closeModal},{default:g(()=>[s.loading?(r(),n("div",N,[a(d,{color:"info",mode:"indeterminate",style:{height:"4px"},pt:{value:{style:{backgroundColor:"#38bdf9"}}}})])):m("",!0),s.modalOpen?(r(),n("div",q,[s.wallet?(r(),n("div",P,[a(w,{modelValue:s.wallet.name,"onUpdate:modelValue":e[0]||(e[0]=p=>s.wallet.name=p),rows:"2",required:"",placeholder:"name",fluid:"",disabled:s.loading},null,8,["modelValue","disabled"]),a(w,{modelValue:s.wallet.description,"onUpdate:modelValue":e[1]||(e[1]=p=>s.wallet.description=p),rows:"4",placeholder:"description",fluid:"",disabled:s.loading},null,8,["modelValue","disabled"])])):m("",!0)])):m("",!0),i("div",$,[a(f,{type:"button",disabled:s.loading,label:"Закрыть",size:"small",severity:"secondary",onClick:o.closeModal},null,8,["disabled","onClick"]),a(f,{type:"button",disabled:s.loading,label:"Сохранить",size:"small",severity:"success",onClick:o.saveWallet},null,8,["disabled","onClick"])])]),_:1},8,["visible","header","onHide"])])}const H=b(A,[["render",F],["__scopeId","data-v-e151edf6"]]),S={name:"WalletsList",setup(){const t=new x,e=new E;return{walletRepository:t,walletUseCase:e}},components:{WalletEditor:H},data(){return{wallets:[],loading:!1,walletEditorModal:{show:!1,walletId:0},deleteWalletModal:{show:!1,walletId:0,loading:!1},activeWallet:null}},methods:{openMenu(t,e){this.activeWallet=e,this.$refs.op.toggle(t)},editActiveWallet(){this.activeWallet&&(this.openWalletEditor(this.activeWallet.id),this.$refs.op.hide())},deleteActiveWallet(){this.activeWallet&&(this.deleteWallet(this.activeWallet.id),this.$refs.op.hide())},getMenuItems(t){return[{label:"Редактировать",icon:"pi pi-pencil",command:()=>this.openWalletEditor(t.id)},{label:"Удалить",icon:"pi pi-trash",command:()=>this.deleteWallet(t.id)}]},async loadWallets(){this.loading=!0;const t=await this.walletUseCase.getUserWallets();t===!1?alert("Ошибка при загрузке кошельков"):this.wallets=t,this.loading=!1},openWalletEditor(t=0){this.walletEditorModal.walletId=t,this.walletEditorModal.show=!0},deleteWallet(t){this.deleteWalletModal.walletId=t,this.$confirm.require({message:"Подтвердите удаление кошелька",header:"Подтверждение удаления",icon:"pi pi-exclamation-triangle",acceptLabel:"Да",rejectLabel:"Отмена",accept:()=>{this.makeDeleteWallet()},reject:()=>{},acceptClass:"p-button-text p-button-danger p-button-sm",rejectClass:"p-button-text p-button-secondary p-button-sm"})},cancelDelation(){this.deleteWalletModal.show=!1,this.deleteWalletModal.walletId=0},async makeDeleteWallet(){this.deleteWalletModal.loading=!0,await this.walletUseCase.deleteWallet(this.deleteWalletModal.walletId)===!1?alert("Ошибка при удалении кошелька"):this.loadWallets(),this.deleteWalletModal.loading=!1,this.deleteWalletModal.show=!1}},mounted(){this.loadWallets()}},T={class:"flex flex-wrap -mx-2 mb-6"},G={class:"w-full md:w-1/2 px-2"},J={class:"w-full md:w-1/2 px-2 text-end"},K={key:0},Q={key:1,class:"text-center"},X={key:2,class:"mt-3"},Y={class:"list-none p-0 m-0"},Z={class:"cursor-pointer flex-1"},ee={class:"text-lg font-medium"},te={class:"text-sm text-secondary"},le=["onClick"],se={style:{display:"flex","flex-direction":"column",gap:"8px",width:"150px"}};function ae(t,e,l,u,s,o){const d=M,w=C,f=B,y=R,p=D("WalletEditor");return r(),n("div",null,[a(y,null,{content:g(()=>[i("div",T,[i("div",G,[a(d,{loading:s.loading,onClick:o.loadWallets,severity:"info",rounded:"",variant:"text",icon:"pi pi-refresh",size:"small"},null,8,["loading","onClick"])]),i("div",J,[a(d,{onClick:e[0]||(e[0]=c=>o.openWalletEditor(0)),disabled:s.loading,icon:"pi pi-plus",severity:"severity",rounded:"",variant:"text",size:"small"},null,8,["disabled"])])]),s.loading?(r(),n("div",K,[a(w,{color:"info",mode:"indeterminate",style:{height:"4px"},pt:{value:{style:{backgroundColor:"#38bdf9"}}}})])):m("",!0),!s.loading&&s.wallets.length===0?(r(),n("div",Q," у вас пока нет кошельков ")):m("",!0),s.wallets.length>0?(r(),n("div",X,[i("ul",Y,[(r(!0),n(L,null,O(s.wallets,c=>(r(),n("li",{key:c.id,class:"flex justify-content-between align-items-center pb-3 surface-card shadow-1 border-round mb-2"},[i("div",Z,[i("div",ee,k(c.balance)+"грн",1),i("div",te,k(c.name),1)]),i("i",{class:"cursor-pointer pi pi-ellipsis-v ml-2",onClick:U=>o.openMenu(U,c)},null,8,le)]))),128))]),a(f,{ref:"op"},{default:g(()=>[i("div",se,[a(d,{label:"Редактировать",icon:"pi pi-pencil",onClick:o.editActiveWallet,style:{width:"100%","justify-content":"flex-start"},class:"p-button-text",size:"small"},null,8,["onClick"]),a(d,{label:"Удалить",icon:"pi pi-trash",onClick:o.deleteActiveWallet,style:{width:"100%","justify-content":"flex-start"},class:"p-button-text p-button-danger",size:"small"},null,8,["onClick"])])]),_:1},512)])):m("",!0)]),_:1}),a(p,{modelValue:s.walletEditorModal.show,"onUpdate:modelValue":e[1]||(e[1]=c=>s.walletEditorModal.show=c),"wallet-id":s.walletEditorModal.walletId,onReload:e[2]||(e[2]=c=>o.loadWallets())},null,8,["modelValue","wallet-id"])])}const ie=b(S,[["render",ae]]),oe={name:"Wallets",components:{WalletsList:ie}},ne={class:"mt-4"},re={class:"flex flex-wrap -mx-2 mb-6"},de={class:"w-full md:w-1/3 px-2"};function ce(t,e,l,u,s,o){const d=D("WalletsList");return r(),n("div",null,[e[0]||(e[0]=i("h1",null,"Мои кошельки",-1)),i("div",ne,[i("div",re,[i("div",de,[a(d)])])])])}const fe=b(oe,[["render",ce]]);export{fe as default};
