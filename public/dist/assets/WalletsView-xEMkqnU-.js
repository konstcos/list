var T=Object.defineProperty;var z=(t,e,a)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var h=(t,e,a)=>(z(t,typeof e!="symbol"?e+"":e,a),a);import{f as k,_ as R,r as n,o as d,c as u,d as l,w as s,e as W,g as E,b as _,p as F,h as A,a as b,F as N,i as P,m as j,t as B}from"./index-75GFfkCt.js";class I{constructor(e={}){h(this,"id",0);h(this,"name","");h(this,"description","");h(this,"сurrency","");h(this,"balance",0);this.id=e.id??0,this.name=e.name??"",this.description=e.description??"",this.balance=e.balance??0}clear(){this.name="",this.description="",this.balance=0}}const V={async getUserWallets(){return(await k.post("wallet/user-wallets",{})).data},async getWalletDetail(t){return(await k.post("wallet/detail",{wallet_id:t})).data},async saveWallet(t){return(await k.post("wallet/save",t)).data},async deleteWallet(t){return(await k.post("wallet/delete",{wallet_id:t})).data}};class O{async getUserWallets(){try{const e=await V.getUserWallets();if(e.status==="success")return e}catch{return!1}}async saveWallet(e){try{const a=await V.saveWallet({id:e.id,name:e.name,description:e.description,balance:e.balance});if(a.status==="success")return a}catch{return!1}}async getWalletDetail(e){try{const a=await V.getWalletDetail(e);if(a.status==="success")return a}catch{return!1}}async deleteWallet(e){try{const a=await V.deleteWallet(e);return a.status==="success"?a:!1}catch{return!1}}}class L{constructor(){this.walletRepository=new O}async getUserWallets(){try{const e=await this.walletRepository.getUserWallets();if(e.status==="success"){let a=[];for(let m of e.data.wallets)a.push(new I({id:m.id,name:m.name,description:m.description,balance:m.balance}));return a}}catch{return!1}}async getWalletDetail(e){try{const a=await this.walletRepository.getWalletDetail(e);return a.status==="success"?new I({id:a.data.wallet.id,name:a.data.wallet.name,description:a.data.wallet.description,balance:a.data.wallet.balance}):!1}catch{return!1}}async deleteWallet(e){try{return(await this.walletRepository.deleteWallet(e)).status==="success"}catch{return!1}}}const q={name:"WalletEditor",setup(){const t=new O,e=new L;return{walletRepository:t,walletUseCase:e}},props:{modelValue:{type:Boolean,default:!1},walletId:{type:Number,default:0}},data(){return{modalOpen:this.value,wallet:null,loading:!0}},watch:{modelValue(t){t?this.openModal():this.closeModal()},modalOpen(t){t&&this.loadWalletData()}},methods:{openModal(){this.modalOpen=!0,this.clearWalletData()},closeModal(){this.modalOpen=!1,this.$emit("update:modelValue",!1)},async saveWallet(){this.loading=!0,await this.walletRepository.saveWallet(this.wallet),this.loading=!1,this.$emit("reload"),this.closeModal()},clearWalletData(){this.wallet&&this.wallet.clear()},async getWalletData(){this.wallet=null,this.loading=!0;const t=await this.walletUseCase.getWalletDetail(this.walletId);t===!1?alert("Ошибка при загрузке данных кошелька"):this.wallet=t,this.loading=!1},loadWalletData(){this.walletId===0?(this.wallet=new I,this.loading=!1):this.getWalletData()}}},G=t=>(F("data-v-a52dbbcf"),t=t(),A(),t),H=G(()=>b("span",{class:"headline"},"Создание нового кошелька",-1)),J={key:0},K={key:1};function Q(t,e,a,m,o,i){const c=n("v-card-title"),f=n("v-progress-linear"),v=n("v-text-field"),M=n("v-textarea"),y=n("v-card-text"),C=n("v-btn"),g=n("v-spacer"),x=n("v-card-actions"),D=n("v-card"),U=n("v-dialog");return d(),u("div",null,[l(U,{modelValue:o.modalOpen,"onUpdate:modelValue":e[2]||(e[2]=p=>o.modalOpen=p),"max-width":"500px","onClick:outside":i.closeModal},{default:s(()=>[l(D,null,{default:s(()=>[l(c,null,{default:s(()=>[H]),_:1}),o.modalOpen?(d(),E(y,{key:0},{default:s(()=>[o.loading?(d(),u("div",J,[l(f,{indeterminate:"",color:"primary"})])):W("",!0),o.wallet?(d(),u("div",K,[l(v,{modelValue:o.wallet.name,"onUpdate:modelValue":e[0]||(e[0]=p=>o.wallet.name=p),label:"Name"},null,8,["modelValue"]),l(M,{modelValue:o.wallet.description,"onUpdate:modelValue":e[1]||(e[1]=p=>o.wallet.description=p),label:"Description"},null,8,["modelValue"])])):W("",!0)]),_:1})):W("",!0),l(x,null,{default:s(()=>[l(C,{density:"compact",color:"primary",onClick:i.closeModal},{default:s(()=>[_("Закрыть")]),_:1},8,["onClick"]),l(g),l(C,{density:"compact",color:"primary",onClick:i.saveWallet},{default:s(()=>[_("Сохранить")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","onClick:outside"])])}const X=R(q,[["render",Q],["__scopeId","data-v-a52dbbcf"]]),Y={name:"WalletsList",setup(){const t=new O,e=new L;return{walletRepository:t,walletUseCase:e}},components:{WalletEditor:X},data(){return{wallets:[],loading:!1,walletEditorModal:{show:!1,walletId:0},deleteWalletModal:{show:!1,walletId:0,loading:!1}}},methods:{async loadWallets(){this.loading=!0;const t=await this.walletUseCase.getUserWallets();t===!1?alert("Ошибка при загрузке кошельков"):this.wallets=t,this.loading=!1},openWalletEditor(t=0){this.walletEditorModal.walletId=t,this.walletEditorModal.show=!0},showWalletDetail(t){console.log("showWalletDetail",t)},deleteWallet(t){this.deleteWalletModal.walletId=t,this.deleteWalletModal.show=!0},cancelDelation(){this.deleteWalletModal.show=!1,this.deleteWalletModal.walletId=0},async makeDeleteWallet(){this.deleteWalletModal.loading=!0,await this.walletUseCase.deleteWallet(this.deleteWalletModal.walletId)===!1?alert("Ошибка при удалении кошелька"):this.loadWallets(),this.deleteWalletModal.loading=!1,this.deleteWalletModal.show=!1}},mounted(){this.loadWallets()}},Z={key:0},$={key:1,class:"text-center"},ee={key:2,class:"mt-3"};function te(t,e,a,m,o,i){const c=n("v-btn"),f=n("VCol"),v=n("VRow"),M=n("v-progress-linear"),y=n("v-list-item-title"),C=n("v-list-item-subtitle"),g=n("v-list-item"),x=n("v-list"),D=n("v-menu"),U=n("VCardText"),p=n("VCard"),S=n("WalletEditor");return d(),u("div",null,[b("div",null,[l(p,null,{default:s(()=>[l(U,null,{default:s(()=>[l(v,{class:"mb-3"},{default:s(()=>[l(f,null,{default:s(()=>[l(c,{loading:o.loading,onClick:i.loadWallets,color:"primary",density:"compact",icon:"mdi:mdi-reload"},null,8,["loading","onClick"])]),_:1}),l(f,{class:"text-end"},{default:s(()=>[l(c,{onClick:e[0]||(e[0]=r=>i.openWalletEditor(0)),disabled:o.loading,density:"compact",icon:"mdi:mdi-plus"},null,8,["disabled"])]),_:1})]),_:1}),o.loading?(d(),u("div",Z,[l(M,{indeterminate:"",color:"primary"})])):W("",!0),!o.loading&&o.wallets.length===0?(d(),u("div",$," у вас пока нет кошельков ")):W("",!0),o.wallets.length>0?(d(),u("div",ee,[(d(!0),u(N,null,P(o.wallets,r=>(d(),E(g,{key:r.id,variant:"elevated",class:"mb-3"},{append:s(()=>[o.deleteWalletModal.show&&o.deleteWalletModal.walletId===r.id?(d(),u(N,{key:0},[l(c,{size:"x-small",onClick:e[1]||(e[1]=w=>i.cancelDelation()),disabled:o.deleteWalletModal.loading},{default:s(()=>[_("отмена")]),_:1},8,["disabled"]),l(c,{size:"x-small",onClick:e[2]||(e[2]=w=>i.makeDeleteWallet()),class:"ml-1",color:"red-accent-4",loading:o.deleteWalletModal.loading},{default:s(()=>[_("удалить")]),_:1},8,["loading"])],64)):(d(),E(D,{key:1},{activator:s(({props:w})=>[l(c,j({icon:"mdi:mdi-dots-vertical"},w,{color:"grey-lighten-1",variant:"text"}),null,16)]),default:s(()=>[l(x,{class:"text-center"},{default:s(()=>[l(g,null,{default:s(()=>[l(y,null,{default:s(()=>[l(c,{density:"compact",onClick:w=>i.openWalletEditor(r.id)},{default:s(()=>[_(" Редактировать ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),l(g,null,{default:s(()=>[l(y,null,{default:s(()=>[l(c,{density:"compact",onClick:w=>i.deleteWallet(r.id),color:"red-accent-4"},{default:s(()=>[_(" Удалить ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))]),default:s(()=>[l(y,{onClick:w=>i.showWalletDetail(r.id)},{default:s(()=>[_(B(r.balance)+" грн ",1)]),_:2},1032,["onClick"]),l(C,{onClick:w=>i.showWalletDetail(r.id)},{default:s(()=>[_(B(r.name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))])):W("",!0)]),_:1})]),_:1})]),l(S,{modelValue:o.walletEditorModal.show,"onUpdate:modelValue":e[3]||(e[3]=r=>o.walletEditorModal.show=r),"wallet-id":o.walletEditorModal.walletId,onReload:e[4]||(e[4]=r=>i.loadWallets())},null,8,["modelValue","wallet-id"])])}const le=R(Y,[["render",te]]),ae={name:"Wallets",components:{WalletsList:le}},se=b("h1",null,"Мои кошельки",-1),oe={class:"mt-4"};function ne(t,e,a,m,o,i){const c=n("WalletsList"),f=n("VCol"),v=n("VRow");return d(),u("div",null,[se,b("div",oe,[l(v,null,{default:s(()=>[l(f,{cols:"4"},{default:s(()=>[l(c)]),_:1})]),_:1})])])}const re=R(ae,[["render",ne]]);export{re as default};
